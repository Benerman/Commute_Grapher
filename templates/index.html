
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Commute Dashboard (Python)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #f8fafc; color: #0f172a; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    h1 { font-size: 20px; margin: 0; }
    .card { background: #fff; border: 1px solid #e2e8f0; border-radius: 14px; padding: 14px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .row { display: grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap: 10px; }
    .row label { font-size: 12px; color: #475569; display: block; margin-bottom: 6px; }
    .row .field { display: flex; flex-direction: column; }
    select, input[type=number], input[type=text] { padding: 8px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; }
    .check { display: inline-flex; align-items: center; gap: 8px; font-size: 14px; margin-right: 10px; }
    .btn { padding: 9px 12px; border: 1px solid #cbd5e1; background: #fff; border-radius: 10px; cursor: pointer; }
    .btn:hover { background: #f1f5f9; }
    .mt { margin-top: 12px; }
    .imgbox { height: 460px; display: flex; align-items: center; justify-content: center; }
    .grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color:#475569; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Commute Dashboard (Python)</h1>
      <div class="mono">DB: {{ ('' + (env or '')) if false else '' }}</div>
    </header>

    <div class="card">
      <form method="get" action="/">
        <div class="row">
          <div class="field">
            <label>Direction</label>
            <select name="direction">
              <option value="H2W" {{ 'selected' if direction=='H2W' else '' }}>Home → Work</option>
              <option value="W2H" {{ 'selected' if direction=='W2H' else '' }}>Work → Home</option>
            </select>
          </div>
          <div class="field">
            <label>Chart</label>
            <select name="chart">
              <option value="line" {{ 'selected' if chart=='line' else '' }}>Line</option>
              <option value="area" {{ 'selected' if chart=='area' else '' }}>Area</option>
              <option value="bar" {{ 'selected' if chart=='bar' else '' }}>Bar</option>
              <option value="scatter" {{ 'selected' if chart=='scatter' else '' }}>Scatter</option>
            </select>
          </div>
          <div class="field">
            <label>Days back</label>
            <select name="days">
              {% for d in [7,14,30,90] %}
              <option value="{{d}}" {{ 'selected' if days==d else '' }}>{{d}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="field">
            <label>Limit points (optional)</label>
            <input type="number" name="limit" min="0" step="1" placeholder="e.g., 200">
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <label class="check"><input type="checkbox" name="traffic" value="1" {{ 'checked' if show_traffic else '' }}> With traffic</label>
            <label class="check"><input type="checkbox" name="static" value="1" {{ 'checked' if show_static else '' }}> No traffic</label>
          </div>
        </div>
        <div class="mt">
          <button class="btn" type="submit">Refresh</button>
        </div>
      </form>
    </div>

    <div class="card mt">
      <div class="imgbox">
        <img src="/chart.png?direction={{direction}}&chart={{chart}}&days={{days}}&traffic={{ 1 if show_traffic else 0 }}&static={{ 1 if show_static else 0 }}{% if request.args.get('limit') %}&limit={{request.args.get('limit')}}{% endif %}" alt="chart" style="max-width:100%;max-height:100%;">
      </div>
    </div>

    <div class="card mt">
      <h3 style="margin:6px 0 10px 0;">Latest Points</h3>
      <div class="grid">
        {% for r in rows[-9:]|reverse %}
        <div class="card" style="padding:10px;">
          <div class="mono">{{ r.ts }}</div>
          <div style="margin-top:4px;font-weight:600;">{{ r.description }}</div>
          <div class="mono" style="margin-top:4px;">{{ r.miles }} mi</div>
          <div style="margin-top:6px;">
            <strong>{{ r.duration_minutes }}</strong> min
            <span style="color:#94a3b8;margin:0 6px;">/</span>
            <strong>{{ r.duration_static }}</strong> min (no traffic)
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</body>
</html>
